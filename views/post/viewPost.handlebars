<main role="main" class="container">
  <div class="row pt-2">
    <div class="col-md-8 blog-main">

      {{#if message}}
      <p>{{message}}</p>
      {{else}}
      <div class="blog-post">
        <h2 class="blog-post-title">{{postTitle}}</h2>
        <img class="mt-2 mb-2" src="{{postImage}}" style="width: 100%;">
        <p class="blog-post-meta">{{#formatDate createdAt}} {{/formatDate}} by <a
            href="/profile/{{postAuthorUsername}}">{{postAuthorName}}</a></p>

        {{{postBody}}}

        <p class="float-right">
          <span id="thumbsUp" class="mr-2 pointer" data-toggle="tooltip" data-placement="bottom" title="Like post"
            onclick="reactToPost(`like`, `{{postId}}`)">
            <i class="far fa-thumbs-up fa-2x mr-2"></i><small class="likesCount text-success">{{likesCount}}</small>
          </span>
          <span id="thumbsDown" class="pointer" data-toggle="tooltip" data-placement="bottom" title="Dislike post"
            onclick="reactToPost(`dislike`, `{{postId}}`)">
            <i class="far fa-thumbs-down fa-2x mr-2"></i><small
              class="dislikesCount text-danger mr-2">{{dislikesCount}}</small>
          </span>
          <span id="banIcon" class="pointer" data-toggle="tooltip" data-placement="bottom" title="Report post"
            onclick="reactToPost(`report`, `{{postId}}`)">
            <i class="fas fa-ban fa-2x text-danger mr-2"></i>
          </span>
        </p>
      </div><!-- /.blog-post -->

      <div class="blog-post">
        <h4>Comments</h4>
        {{#unless Comments}} <p>No user has commented on this post for now.</p> {{/unless}}
        {{#each Comments}}
        <p>{{commentBody}}</p>
        <p>{{#formatDate createdAt}} {{/formatDate}}</p>
        <p>By {{commentBy}}</p>
        <p>{{commentByUserId}}</p>
        {{/each}}
      </div>

      <div class="blog-post">
        <h4>Subscribe to more posts from {{postAuthorShortName}}</h4>
        <form class="form-inline" method="POST" action="/subscribe/{{postAuthorUsername}}">
          <label class="sr-only" for="subscribeEmail">Email Address</label>
          <input type="email" class="form-control mb-2 mr-sm-2" id="subscribeEmail" placeholder="Email address">

          <button type="submit" class="btn btn-secondary mb-2">Subscribe</button>
        </form>
      </div><!-- /.blog-post -->
      {{/if}}
    </div><!-- /.blog-main -->

    <aside class="col-md-4 blog-sidebar">
      <div class="p-4 mb-3 bg-light rounded">
        <h4 class="font-italic">About {{postAuthorShortName}}</h4>
        <p class="mb-0">{{postAuthorAbout}}</p>
            {{#unless following}}
    <input type="button" class="btn btn-secondary followButton mt-2" onclick="followUser(`{{username}}`)"
      value="Follow" />
    {{else}}
    <input type="button" class="btn btn-outline-secondary followButton mt-2" value="Following" />
    {{/unless}}
        {{!-- <input type="button" class="btn btn-secondary followButton mt-2" onclick="followUser(`{{postAuthorUsername}}`)" value="Follow" /> --}}
      </div>

      <div class="p-4">
        <h4 class="font-italic">Archives</h4>
        <ol class="list-unstyled mb-0">
          <li><a href="#">March 2014</a></li>
          <li><a href="#">February 2014</a></li>
          <li><a href="#">January 2014</a></li>
          <li><a href="#">December 2013</a></li>
          <li><a href="#">November 2013</a></li>
          <li><a href="#">October 2013</a></li>
          <li><a href="#">September 2013</a></li>
          <li><a href="#">August 2013</a></li>
          <li><a href="#">July 2013</a></li>
          <li><a href="#">June 2013</a></li>
          <li><a href="#">May 2013</a></li>
          <li><a href="#">April 2013</a></li>
        </ol>
      </div>

      <div class="p-4">
        <h4 class="font-italic">Find {{postAuthorShortName}} elsewhere</h4>
        <p class="mt-2">
          <span class="mr-2"> <a class="text-dark" href="https://www.facebook.com/{{postAuthorFacebook}}" target="_blank"><i
                class="fab fa-facebook fa-2x"></i></a></span>
          <span class="mr-2"> <a class="text-dark" href="https://www.linkedin.com/in/{{postAuthorLinkedIn}}" target="_blank"><i
                class="fab fa-linkedin fa-2x"></i></a></span>
          <span class="mr-2"> <a class="text-dark" href="https://www.twitter.com/{{postAuthorTwitter}}" target="_blank"><i
                class="fab fa-twitter fa-2x"></i></a></span>
          <span class="mr-2"> <a class="text-dark" href="https://www.github.com/{{postAuthorGithub}}" target="_blank"><i
                class="fab fa-github fa-2x"></i></a></span>
        </p>
      </div>

      <div class="p-4">
        <h4 class="font-italic">Follow {{postAuthorShortName}}</h4>
            {{#unless following}}
    <input type="button" class="btn btn-secondary followButton mt-2" onclick="followUser(`{{username}}`)"
      value="Follow" />
    {{else}}
    <input type="button" class="btn btn-outline-secondary followButton mt-2" value="Following" />
    {{/unless}}
        {{!-- <input type="button" class="btn btn-secondary followButton mt-2" onclick="followUser(`{{postAuthorUsername}}`)" value="Follow" /> --}}
        {{!-- <span class="border border-danger rounded p-2 align-bottom followButton" onclick="followUser(`{{username}}`)">Following</span> --}}
      </div>
    </aside><!-- /.blog-sidebar -->

  </div><!-- /.row -->

  <!-- Then put toasts within -->
  <div class="toast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header">
      <img src="..." class="rounded mr-2" alt="...">
      <strong class="mr-auto">Bootstrap</strong>
      <small class="text-muted">just now</small>
      <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="toast-body">
      See? Just like this.
    </div>
  </div>

</main>

<script type="text/javascript">
  $(function () {
    $('[data-toggle="tooltip"]').tooltip();
  });

  function reactToPost(reaction, postId) {
    var reVal = reaction;
    fetch(`/api/react/${reaction}/${postId}`).then(response => response.json())
      .then((data) => {
        if (!data.response) {
          $('.likesCount').text(data.likesCount);
          $('.dislikesCount').text(data.dislikesCount);
          $('#thumbsUp').removeClass('text-danger');
          $('#thumbsDown').removeClass('text-danger');
        } else {
          if (reaction === 'like') {
            $('#thumbsUp').addClass('text-danger');
            $('#thumbsDown').removeClass('text-danger');
          } else {
            $('#thumbsUp').removeClass('text-danger');
            $('#thumbsDown').addClass('text-danger');
          }
        }
      });
  }

  function followUser(username){
    fetch(`/api/follow/${username}`).then(response => response.json())
      .then((data) => {
        console.log(data);
        $('.followButton').attr('onclick', '');
        $('.followButton').text('Following');
        $('.followButton').removeClass('btn-secondary').addClass('btn-outline-secondary');
      }).catch((err)=>{
        console.log(err);
      });
  }
</script>